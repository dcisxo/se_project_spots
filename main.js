!function(){"use strict";var e="",t=e+"images/logo.svg",r=e+"images/pencil.svg",n=e+"images/plus.svg",o=e+"images/avatar.jpg",a=e+"images/close-icon.svg",i=function(e,t,r){var n=e.querySelector("#".concat(t.id,"-error"));n.textContent="",t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass)},c=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(r.inactiveButtonClass)):l(t,r)},l=function(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)},u=function(e){document.querySelectorAll(e.formSelector).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);c(r,n,t),e.addEventListener("reset",(function(){setTimeout((function(){c(r,n,t),r.forEach((function(r){i(e,r,t)}))}),0)})),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?i(e,t,r):function(e,t,r,n){var o=e.querySelector("#".concat(t.id,"-error"));o.textContent=r,t.classList.add(n.inputErrorClass),o.classList.add(n.errorClass)}(e,t,t.validationMessage,r)}(e,o,t),c(r,n,t)}))}))}(t,e)}))},s=function(e,t,r){t.forEach((function(t){i(e,t,r)}))};function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function m(e){var t=function(e){if("object"!=d(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==d(t)?t:t+""}u({formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"});var _=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers},(t=[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}},{key:"_request",value:function(e,t){return fetch(e,t).then(this._checkResponse)}},{key:"getInitialCards",value:function(){return this._request("".concat(this._baseUrl,"/cards"),{headers:this._headers})}},{key:"getUserInfo",value:function(){return this._request("".concat(this._baseUrl,"/users/me"),{headers:this._headers})}},{key:"editProfile",value:function(e,t){return this._request("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})})}},{key:"editAvatar",value:function(e){return this._request("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}},{key:"addCard",value:function(e,t){return this._request("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})})}},{key:"deleteCard",value:function(e){return this._request("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers})}},{key:"likeCard",value:function(e){return this._request("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers})}},{key:"dislikeCard",value:function(e){return this._request("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers})}}])&&f(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}document.querySelector(".header__logo").src=t,document.querySelector(".profile__edit-btn img").src=r,document.querySelector(".profile__add-btn img").src=n,document.querySelector(".profile__avatar").src=o;var y=new _({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"932461a1-5689-412a-b2e1-d7861760d1f6","Content-Type":"application/json"}}),b={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};u(b);var h=document.querySelector(".profile__edit-btn"),S=document.querySelector(".profile__add-btn"),p=document.querySelector(".profile__name"),q=document.querySelector(".profile__description"),k=document.querySelector("#edit-modal"),g=document.forms["edit-profile"],E=k.querySelector(".modal__close-btn"),C=k.querySelector("#profile-name-input"),L=k.querySelector("#profile-desc-input"),U=document.querySelector("#add-card-modal"),w=document.forms["add-card"],A=(U.querySelector(".modal__submit-btn"),U.querySelector(".modal__close-btn")),j=U.querySelector("#add-card-name-input"),x=U.querySelector("#add-card-link-input"),P=document.querySelector("#preview-modal"),T=P.querySelector(".modal__image"),D=P.querySelector(".modal__caption"),O=P.querySelector(".modal__close-btn"),B=document.querySelector("#avatar-modal"),I=document.forms.avatar,N=B.querySelector(".modal__close-btn"),J=B.querySelector("#avatar-link-input"),H=document.querySelector(".profile__avatar"),M=document.querySelector("#card-template"),R=document.querySelector(".cards__list"),z=document.querySelector("#delete-card-modal"),$=document.forms["delete-card"],F=z.querySelector(".modal__close-btn"),G=z.querySelector(".modal__cancel-btn");E.querySelector("img").src=a,A.querySelector("img").src=a,F.querySelector("img").src=a,N.querySelector("img").src=a;var K,Q,V={};function W(e){e.target.classList.contains("modal")&&Z(e.target)}function X(e){"Escape"===e.key&&Z(document.querySelector(".modal_opened"))}function Y(e){e.classList.add("modal_opened"),document.addEventListener("keydown",X),e.addEventListener("click",W)}function Z(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",X),e.removeEventListener("click",W)}function ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",r=function(e){var t=M.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),o=t.querySelector(".card__like-btn"),a=t.querySelector(".card__remove-btn");return r.textContent=e.name,n.src=e.link,n.alt=e.name,e.likes&&e.likes.some((function(e){return e._id===V._id}))&&o.classList.add("card__like-btn_liked"),e.owner!==V._id&&(a.style.display="none"),o.addEventListener("click",(function(){var t=o.classList.contains("card__like-btn_liked");o.disabled=!0,t?y.dislikeCard(e._id).then((function(t){o.classList.remove("card__like-btn_liked"),e.likes=t.likes})).catch((function(e){return console.error("Error disliking card:",e)})).finally((function(){o.disabled=!1})):y.likeCard(e._id).then((function(t){o.classList.add("card__like-btn_liked"),e.likes=t.likes})).catch((function(e){return console.error("Error liking card:",e)})).finally((function(){o.disabled=!1}))})),a.addEventListener("click",(function(){K=t,Q=e._id,Y(z)})),n.addEventListener("click",(function(){Y(P),D.textContent=e.name,T.src=e.link,T.alt=e.name})),t}(e);R[t](r)}function te(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";t.textContent=e?n:r}Promise.all([y.getUserInfo(),y.getInitialCards()]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],l=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],a=n[1];V=o,p.textContent=o.name,q.textContent=o.about,document.querySelector(".profile__avatar").src=o.avatar,a.forEach((function(e){ee(e,"append")}))})).catch((function(e){console.error("Error loading initial data:",e)})),h.addEventListener("click",(function(){C.value=p.textContent,L.value=q.textContent,s(g,[C,L],b),Y(k)})),E.addEventListener("click",(function(){Z(k)})),S.addEventListener("click",(function(){s(w,[j,x],b),Y(U)})),A.addEventListener("click",(function(){Z(U)})),O.addEventListener("click",(function(){Z(P)})),F.addEventListener("click",(function(){Z(z)})),G.addEventListener("click",(function(){Z(z)})),document.querySelector(".profile__avatar-container").addEventListener("click",(function(){s(I,[J],b),Y(B)})),N.addEventListener("click",(function(){Z(B)})),I.addEventListener("submit",(function(e){e.preventDefault();var t=I.querySelector(".modal__submit-btn");te(!0,t,"Save","Saving..."),y.editAvatar(J.value).then((function(e){H.src=e.avatar,I.reset(),Z(B)})).catch((function(e){console.error("Error updating avatar:",e)})).finally((function(){te(!1,t,"Save")}))})),$.addEventListener("submit",(function(e){e.preventDefault();var t=$.querySelector(".modal__submit-btn");te(!0,t,"Delete","Deleting..."),y.deleteCard(Q).then((function(){K.remove(),Z(z),K=null,Q=null})).catch((function(e){console.error("Error deleting card:",e)})).finally((function(){te(!1,t,"Delete")}))})),g.addEventListener("submit",(function(e){e.preventDefault();var t=g.querySelector(".modal__submit-btn");te(!0,t,"Save","Saving..."),y.editProfile(C.value,L.value).then((function(e){p.textContent=e.name,q.textContent=e.about,Z(k)})).catch((function(e){console.error("Error updating profile:",e)})).finally((function(){te(!1,t,"Save")}))})),w.addEventListener("submit",(function(e){e.preventDefault();var t=w.querySelector(".modal__submit-btn");te(!0,t,"Save","Saving..."),y.addCard(j.value,x.value).then((function(e){ee(e),w.reset(),Z(U)})).catch((function(e){console.error("Error adding card:",e)})).finally((function(){te(!1,t,"Save")}))}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZTVFLEVBQVN0RixjQUFjLHNCQUU1Q29KLElBQWMsRUFBTWMsRUFBYyxPQUFRLGFBRTFDMUYsRUFBSStGLFFBQVEvRSxFQUFjMUMsTUFBTzJDLEVBQWMzQyxPQUM1Q1MsTUFBSyxTQUFDeUcsR0FDTDFDLEdBQVcwQyxHQUNYMUUsRUFBUzhFLFFBQ1RuRCxFQUFXNUIsRUFDYixJQUNDd0QsT0FBTSxTQUFDQyxHQUNOQyxRQUFRQyxNQUFNLHFCQUFzQkYsRUFDdEMsSUFDQ0csU0FBUSxXQUNQRyxJQUFjLEVBQU9jLEVBQWMsT0FDckMsR0FDSixHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzL3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy9BcGkuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjsiLCJjb25zdCBzZXR0aW5ncyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idG5fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgZXJyb3JNc2csIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0VsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBlcnJvck1zZztcbiAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xuICBlcnJvck1zZ0VsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xuICBlcnJvck1zZ0VsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWwsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcblxuY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuXG4gIGZvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwicmVzZXRcIiwgKCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKTtcbiAgICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgICAgIH0pO1xuICAgIH0sIDApO1xuICB9KTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbmNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpO1xuICB9KTtcbn07XG5cbmNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWwsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXQsIGNvbmZpZyk7XG4gIH0pO1xufTtcblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG5leHBvcnQgeyBlbmFibGVWYWxpZGF0aW9uLCByZXNldFZhbGlkYXRpb24sIHNldHRpbmdzIH07IiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBvcHRpb25zLmJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBfcmVxdWVzdCh1cmwsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gZmV0Y2godXJsLCBvcHRpb25zKS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRQcm9maWxlKG5hbWUsIGFib3V0KSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgIGFib3V0OiBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pO1xuICB9XG5cbiAgZWRpdEF2YXRhcihhdmF0YXIpIHtcbiAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgYXZhdGFyOiBhdmF0YXIsXG4gICAgfSksXG4gIH0pO1xufVxuXG4gIGFkZENhcmQobmFtZSwgbGluaykge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgIGxpbms6IGxpbmssXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG5saWtlQ2FyZChjYXJkSWQpIHtcbiAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICB9KTtcbn1cblxuZGlzbGlrZUNhcmQoY2FyZElkKSB7XG4gIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgfSk7XG59XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTsiLCJpbXBvcnQgXCIuLi9wYWdlcy9pbmRleC5jc3NcIjtcbmltcG9ydCBsb2dvUGF0aCBmcm9tIFwiLi4vaW1hZ2VzL2xvZ28uc3ZnXCI7XG5pbXBvcnQgcGVuY2lsUGF0aCBmcm9tIFwiLi4vaW1hZ2VzL3BlbmNpbC5zdmdcIjtcbmltcG9ydCBwbHVzUGF0aCBmcm9tIFwiLi4vaW1hZ2VzL3BsdXMuc3ZnXCI7XG5pbXBvcnQgYXZhdGFyUGF0aCBmcm9tIFwiLi4vaW1hZ2VzL2F2YXRhci5qcGdcIjtcbmltcG9ydCBjbG9zZUljb24gZnJvbSBcIi4uL2ltYWdlcy9jbG9zZS1pY29uLnN2Z1wiO1xuaW1wb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgcmVzZXRWYWxpZGF0aW9uIH0gZnJvbSAnLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzJztcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3NjcmlwdHMvQXBpLmpzXCI7XG5cblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5oZWFkZXJfX2xvZ29cIikuc3JjID0gbG9nb1BhdGg7XG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuIGltZ1wiKS5zcmMgPSBwZW5jaWxQYXRoO1xuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuIGltZ1wiKS5zcmMgPSBwbHVzUGF0aDtcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpLnNyYyA9IGF2YXRhclBhdGg7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjkzMjQ2MWExLTU2ODktNDEyYS1iMmUxLWQ3ODYxNzYwZDFmNlwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gIH1cbn0pO1xuXG4vLyBWYWxpZGF0aW9uIHNldHRpbmdzXG5jb25zdCBzZXR0aW5ncyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idG5fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIlxufTtcblxuLy8gRW5hYmxlIGZvcm0gdmFsaWRhdGlvblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG5cbi8vUHJvZmlsZSBFbGVtZW50c1xuY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xuY29uc3QgY2FyZEVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG5cIik7XG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcblxuLy9Gb3JtIEVsZW1lbnRzXG5jb25zdCBlZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtbW9kYWxcIik7XG5jb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBkb2N1bWVudC5mb3Jtc1tcImVkaXQtcHJvZmlsZVwiXTtcbmNvbnN0IGVkaXRNb2RhbENsb3NlQnRuID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGVkaXRNb2RhbE5hbWVJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IGVkaXRNb2RhbERlc2NJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtZGVzYy1pbnB1dFwiKTtcblxuY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IGNhcmRGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJhZGQtY2FyZFwiXTtcbmNvbnN0IGNhcmRTdWJtaXRCdG4gPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0blwiKTtcbmNvbnN0IGNhcmRNb2RhbENsb3NlQnRuID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGNhcmROYW1lSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1uYW1lLWlucHV0XCIpO1xuY29uc3QgY2FyZExpbmtJbnB1dCA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLWxpbmstaW5wdXRcIik7XG5cbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbEltYWdlRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG5jb25zdCBwcmV2aWV3TW9kYWxDYXB0aW9uRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcblxuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImF2YXRhclwiXTtcbmNvbnN0IGF2YXRhck1vZGFsQ2xvc2VCdG4gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBhdmF0YXJMaW5rSW5wdXQgPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1saW5rLWlucHV0XCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuXG4vLyBDYXJkIHJlbGF0ZWQgZWxlbWVudHNcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImRlbGV0ZS1jYXJkXCJdO1xuY29uc3QgZGVsZXRlTW9kYWxDbG9zZUJ0biA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGRlbGV0ZU1vZGFsQ2FuY2VsQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FuY2VsLWJ0blwiKTtcblxuZWRpdE1vZGFsQ2xvc2VCdG4ucXVlcnlTZWxlY3RvcihcImltZ1wiKS5zcmMgPSBjbG9zZUljb247XG5jYXJkTW9kYWxDbG9zZUJ0bi5xdWVyeVNlbGVjdG9yKFwiaW1nXCIpLnNyYyA9IGNsb3NlSWNvbjtcbmRlbGV0ZU1vZGFsQ2xvc2VCdG4ucXVlcnlTZWxlY3RvcihcImltZ1wiKS5zcmMgPSBjbG9zZUljb247XG5hdmF0YXJNb2RhbENsb3NlQnRuLnF1ZXJ5U2VsZWN0b3IoXCJpbWdcIikuc3JjID0gY2xvc2VJY29uO1xuXG5sZXQgY3VycmVudFVzZXIgPSB7fTtcbmxldCBzZWxlY3RlZENhcmQ7XG5sZXQgc2VsZWN0ZWRDYXJkSWQ7XG5cbmZ1bmN0aW9uIGhhbmRsZU92ZXJsYXlDbGljayhldnQpIHtcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbCcpKSB7XG4gICAgY2xvc2VNb2RhbChldnQudGFyZ2V0KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVFc2NDbG9zZShldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIGNsb3NlTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX29wZW5lZCcpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUVzY0Nsb3NlKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVPdmVybGF5Q2xpY2spO1xufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVFc2NDbG9zZSk7XG4gIG1vZGFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlT3ZlcmxheUNsaWNrKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdXR0b24gPSBlZGl0Rm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0blwiKTtcblxuICByZW5kZXJMb2FkaW5nKHRydWUsIHN1Ym1pdEJ1dHRvbiwgXCJTYXZlXCIsIFwiU2F2aW5nLi4uXCIpO1xuXG4gIGFwaS5lZGl0UHJvZmlsZShlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUsIGVkaXRNb2RhbERlc2NJbnB1dC52YWx1ZSlcbiAgICAudGhlbigodXNlckRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlckRhdGEubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIHByb2ZpbGU6XCIsIGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBzdWJtaXRCdXR0b24sIFwiU2F2ZVwiKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZFN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGNhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5cbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24sIFwiU2F2ZVwiLCBcIlNhdmluZy4uLlwiKTtcblxuICBhcGkuYWRkQ2FyZChjYXJkTmFtZUlucHV0LnZhbHVlLCBjYXJkTGlua0lucHV0LnZhbHVlKVxuICAgIC50aGVuKChjYXJkRGF0YSkgPT4ge1xuICAgICAgcmVuZGVyQ2FyZChjYXJkRGF0YSk7XG4gICAgICBjYXJkRm9ybS5yZXNldCgpO1xuICAgICAgY2xvc2VNb2RhbChjYXJkTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhZGRpbmcgY2FyZDpcIiwgZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIHN1Ym1pdEJ1dHRvbiwgXCJTYXZlXCIpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZE5hbWVFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBjb25zdCBjYXJkUmVtb3ZlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19yZW1vdmUtYnRuXCIpO1xuXG4gIGNhcmROYW1lRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgY2FyZEltYWdlRWwuYWx0ID0gZGF0YS5uYW1lO1xuXG4gIC8vIENoZWNrIGlmIGN1cnJlbnQgdXNlciBoYXMgbGlrZWQgdGhpcyBjYXJkIChhZGQgc2FmZXR5IGNoZWNrIGZvciBsaWtlcyBhcnJheSlcbiAgY29uc3QgaXNMaWtlZCA9IGRhdGEubGlrZXMgJiYgZGF0YS5saWtlcy5zb21lKHVzZXIgPT4gdXNlci5faWQgPT09IGN1cnJlbnRVc2VyLl9pZCk7XG4gIGlmIChpc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xuICB9XG5cbiAgLy8gT25seSBzaG93IGRlbGV0ZSBidXR0b24gaWYgY3VycmVudCB1c2VyIG93bnMgdGhlIGNhcmQgKGFkZCBzYWZldHkgY2hlY2spXG4gIGlmIChkYXRhLm93bmVyICE9PSBjdXJyZW50VXNlci5faWQpIHtcbiAgY2FyZFJlbW92ZUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG59XG5cbmNhcmRMaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNvbnN0IGlzQ3VycmVudGx5TGlrZWQgPSBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcblxuICAvLyBEaXNhYmxlIGJ1dHRvbiBkdXJpbmcgcmVxdWVzdFxuICBjYXJkTGlrZUJ0bi5kaXNhYmxlZCA9IHRydWU7XG5cbiAgaWYgKGlzQ3VycmVudGx5TGlrZWQpIHtcbiAgICBhcGkuZGlzbGlrZUNhcmQoZGF0YS5faWQpXG4gICAgICAudGhlbigodXBkYXRlZENhcmQpID0+IHtcbiAgICAgICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xuICAgICAgICBkYXRhLmxpa2VzID0gdXBkYXRlZENhcmQubGlrZXM7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkaXNsaWtpbmcgY2FyZDpcIiwgZXJyKSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgY2FyZExpa2VCdG4uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGFwaS5saWtlQ2FyZChkYXRhLl9pZClcbiAgICAgIC50aGVuKCh1cGRhdGVkQ2FyZCkgPT4ge1xuICAgICAgICBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gICAgICAgIGRhdGEubGlrZXMgPSB1cGRhdGVkQ2FyZC5saWtlcztcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihcIkVycm9yIGxpa2luZyBjYXJkOlwiLCBlcnIpKVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBjYXJkTGlrZUJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfSk7XG4gIH1cbn0pO1xuXG4gIGNhcmRSZW1vdmVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xuICAgIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XG4gIH0pO1xuXG4gIGNhcmRJbWFnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XG4gICAgcHJldmlld01vZGFsQ2FwdGlvbkVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgIHByZXZpZXdNb2RhbEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdNb2RhbEltYWdlRWwuYWx0ID0gZGF0YS5uYW1lO1xuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIHJlbmRlckNhcmQoaXRlbSwgbWV0aG9kID0gXCJwcmVwZW5kXCIpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgY2FyZHNMaXN0W21ldGhvZF0oY2FyZEVsZW1lbnQpO1xufVxuXG5Qcm9taXNlLmFsbChbYXBpLmdldFVzZXJJbmZvKCksIGFwaS5nZXRJbml0aWFsQ2FyZHMoKV0pXG4gIC50aGVuKChbdXNlckRhdGEsIGNhcmRzXSkgPT4ge1xuICAgIC8vIFN0b3JlIGN1cnJlbnQgdXNlciBkYXRhXG4gICAgY3VycmVudFVzZXIgPSB1c2VyRGF0YTtcblxuICAgIC8vIFVwZGF0ZSBwcm9maWxlIHdpdGggdXNlciBkYXRhXG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xuICAgIHByb2ZpbGVEZXNjLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQ7XG4gICAgLy8gVXBkYXRlIGF2YXRhciBmcm9tIHNlcnZlciBkYXRhXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIikuc3JjID0gdXNlckRhdGEuYXZhdGFyO1xuXG4gICAgLy8gUmVuZGVyIGNhcmRzIGZyb20gc2VydmVyXG4gICAgY2FyZHMuZm9yRWFjaChjYXJkRGF0YSA9PiB7XG4gICAgICByZW5kZXJDYXJkKGNhcmREYXRhLCBcImFwcGVuZFwiKTtcbiAgICB9KTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyBpbml0aWFsIGRhdGE6XCIsIGVycik7XG4gIH0pO1xuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdXR0b24gPSBkZWxldGVGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5cbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24sIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XG5cbiAgYXBpLmRlbGV0ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgICBzZWxlY3RlZENhcmQgPSBudWxsO1xuICAgICAgc2VsZWN0ZWRDYXJkSWQgPSBudWxsO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBjYXJkOlwiLCBlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgc3VibWl0QnV0dG9uLCBcIkRlbGV0ZVwiKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gYXZhdGFyRm9ybS5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xuXG4gIHJlbmRlckxvYWRpbmcodHJ1ZSwgc3VibWl0QnV0dG9uLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG5cbiAgYXBpLmVkaXRBdmF0YXIoYXZhdGFyTGlua0lucHV0LnZhbHVlKVxuICAgIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZUF2YXRhci5zcmMgPSB1c2VyRGF0YS5hdmF0YXI7XG4gICAgICBhdmF0YXJGb3JtLnJlc2V0KCk7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgYXZhdGFyOlwiLCBlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgc3VibWl0QnV0dG9uLCBcIlNhdmVcIik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nLCBidXR0b24sIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIsIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIikge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gZGVmYXVsdFRleHQ7XG4gIH1cbn1cblxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZWRpdE1vZGFsTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XG4gIGVkaXRNb2RhbERlc2NJbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjLnRleHRDb250ZW50O1xuICByZXNldFZhbGlkYXRpb24oZWRpdEZvcm1FbGVtZW50LCBbZWRpdE1vZGFsTmFtZUlucHV0LCBlZGl0TW9kYWxEZXNjSW5wdXRdLCBzZXR0aW5ncyk7XG4gIG9wZW5Nb2RhbChlZGl0TW9kYWwpO1xufSk7XG5cbmVkaXRNb2RhbENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcbn0pO1xuXG5jYXJkRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICByZXNldFZhbGlkYXRpb24oY2FyZEZvcm0sIFtjYXJkTmFtZUlucHV0LCBjYXJkTGlua0lucHV0XSwgc2V0dGluZ3MpO1xuICBvcGVuTW9kYWwoY2FyZE1vZGFsKTtcbn0pO1xuXG5jYXJkTW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGNhcmRNb2RhbCk7XG59KTtcblxucHJldmlld01vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpO1xufSk7XG5cbmRlbGV0ZU1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcblxuZGVsZXRlTW9kYWxDYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcblxuY29uc3QgcHJvZmlsZUF2YXRhckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWNvbnRhaW5lclwiKTtcbnByb2ZpbGVBdmF0YXJDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcmVzZXRWYWxpZGF0aW9uKGF2YXRhckZvcm0sIFthdmF0YXJMaW5rSW5wdXRdLCBzZXR0aW5ncyk7XG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG59KTtcblxuYXZhdGFyTW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbn0pO1xuXG5hdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQXZhdGFyU3VibWl0KTtcbmRlbGV0ZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVTdWJtaXQpO1xuZWRpdEZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRWRpdEZvcm1TdWJtaXQpO1xuY2FyZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRDYXJkU3VibWl0KTtcblxuIl0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbCIsImlucHV0RWwiLCJjb25maWciLCJlcnJvck1zZ0VsIiwicXVlcnlTZWxlY3RvciIsImNvbmNhdCIsImlkIiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbCIsInNvbWUiLCJpbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlZCIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJkaXNhYmxlQnV0dG9uIiwiYWRkIiwiZW5hYmxlVmFsaWRhdGlvbiIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvcm1TZWxlY3RvciIsImZvckVhY2giLCJBcnJheSIsImZyb20iLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwic2V0VGltZW91dCIsImVycm9yTXNnIiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNldEV2ZW50TGlzdGVuZXJzIiwicmVzZXRWYWxpZGF0aW9uIiwiQXBpIiwib3B0aW9ucyIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJfYmFzZVVybCIsImJhc2VVcmwiLCJfaGVhZGVycyIsImhlYWRlcnMiLCJrZXkiLCJ2YWx1ZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJ1cmwiLCJmZXRjaCIsInRoZW4iLCJfY2hlY2tSZXNwb25zZSIsIl9yZXF1ZXN0IiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhdmF0YXIiLCJsaW5rIiwiY2FyZElkIiwic3JjIiwibG9nb1BhdGgiLCJwZW5jaWxQYXRoIiwicGx1c1BhdGgiLCJhdmF0YXJQYXRoIiwiYXBpIiwiYXV0aG9yaXphdGlvbiIsInNldHRpbmdzIiwicHJvZmlsZUVkaXRCdXR0b24iLCJjYXJkRWRpdEJ1dHRvbiIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2MiLCJlZGl0TW9kYWwiLCJlZGl0Rm9ybUVsZW1lbnQiLCJmb3JtcyIsImVkaXRNb2RhbENsb3NlQnRuIiwiZWRpdE1vZGFsTmFtZUlucHV0IiwiZWRpdE1vZGFsRGVzY0lucHV0IiwiY2FyZE1vZGFsIiwiY2FyZEZvcm0iLCJjYXJkTW9kYWxDbG9zZUJ0biIsImNhcmROYW1lSW5wdXQiLCJjYXJkTGlua0lucHV0IiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsSW1hZ2VFbCIsInByZXZpZXdNb2RhbENhcHRpb25FbCIsInByZXZpZXdNb2RhbENsb3NlQnRuIiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJGb3JtIiwiYXZhdGFyTW9kYWxDbG9zZUJ0biIsImF2YXRhckxpbmtJbnB1dCIsInByb2ZpbGVBdmF0YXIiLCJjYXJkVGVtcGxhdGUiLCJjYXJkc0xpc3QiLCJkZWxldGVNb2RhbCIsImRlbGV0ZUZvcm0iLCJkZWxldGVNb2RhbENsb3NlQnRuIiwiZGVsZXRlTW9kYWxDYW5jZWxCdG4iLCJjbG9zZUljb24iLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImN1cnJlbnRVc2VyIiwiaGFuZGxlT3ZlcmxheUNsaWNrIiwiZXZ0IiwidGFyZ2V0IiwiY29udGFpbnMiLCJjbG9zZU1vZGFsIiwiaGFuZGxlRXNjQ2xvc2UiLCJvcGVuTW9kYWwiLCJtb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZW5kZXJDYXJkIiwiaXRlbSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImNhcmRFbGVtZW50IiwiZGF0YSIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkTmFtZUVsIiwiY2FyZEltYWdlRWwiLCJjYXJkTGlrZUJ0biIsImNhcmRSZW1vdmVCdG4iLCJhbHQiLCJsaWtlcyIsInVzZXIiLCJfaWQiLCJvd25lciIsInN0eWxlIiwiZGlzcGxheSIsImlzQ3VycmVudGx5TGlrZWQiLCJkaXNsaWtlQ2FyZCIsInVwZGF0ZWRDYXJkIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJmaW5hbGx5IiwibGlrZUNhcmQiLCJnZXRDYXJkRWxlbWVudCIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJidXR0b24iLCJkZWZhdWx0VGV4dCIsImxvYWRpbmdUZXh0IiwiYWxsIiwiZ2V0VXNlckluZm8iLCJnZXRJbml0aWFsQ2FyZHMiLCJfcmVmIiwiX3JlZjIiLCJ1c2VyRGF0YSIsImNhcmRzIiwiY2FyZERhdGEiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ1dHRvbiIsImVkaXRBdmF0YXIiLCJyZXNldCIsImRlbGV0ZUNhcmQiLCJlZGl0UHJvZmlsZSIsImFkZENhcmQiXSwic291cmNlUm9vdCI6IiJ9